@using BlazorServerApp.Data
@inject TicTacToeService tictactoesvc

<div>@InstanceId</div>
<div id="@InstanceId" class="game">
    @for (int r = 0; r < @GridSize; r++)
    {
        <div class="gamerow">
            @for (int c = 0; c < GridSize; c++)
            {
                int i = r * GridSize + c;
                
                List<string> cssClasses = new List<string>() { "gamecell" };
                
                if (r == 0)
                    cssClasses.Add("firstrow");
                else if (r == GridSize -1)
                    cssClasses.Add("lastrow");
                else
                    cssClasses.Add("midrow");

                if (c == 0)
                    cssClasses.Add("firstcol");
                else if (c == GridSize - 1)
                    cssClasses.Add("lastcol");
                else
                    cssClasses.Add("midcol");

                int CellState = CellStates[i];

                string imgUrl = "/Tic-Tac-Toe/Blank120x120.png";
                string symbolColor = WinningCells.Contains(i) ? "Red" : string.Empty;
                
                if (CellState == 1)
                    imgUrl = $"/Tic-Tac-Toe/Cross{symbolColor}120x120.png";
                else if (CellState == 2)
                    imgUrl = $"/Tic-Tac-Toe/Circle{symbolColor}120x120.png";

                List<string> contentCssClasses = new List<string>() { "gamecellcontent" };

                <div id="cell@(i)" class="@(string.Join(" ", cssClasses))">
                    <img class="@(string.Join(" ", contentCssClasses))" src="@imgUrl" @onclick="e => imgOnClick(e, i)" />
                </div>
            }
        </div>
    }
</div>
<br/>
@code {
    // Demonstrates how a parent component can supply parameters
    [Parameter]
    public string InstanceId { get; set; }

    [Parameter]
    public int GridSize { get; set; }

    private List<int> CellStates = new List<int>();
    private List<int> WinningCells = new List<int>();

    protected override void OnParametersSet()
    {
        int arraySize = GridSize * GridSize;
        var array = new int[arraySize];
        CellStates.AddRange(array);

        base.OnParametersSet();
    }

    public void imgOnClick(MouseEventArgs e, int cellIndex)
    {
        var CellState = CellStates[cellIndex];
        if (CellState == 0)
        {
            CellStates[cellIndex] = 1;
            //TO DO: Call TicTacToeService here
            tictactoesvc.UpdateTicTacToeAsync();
            StateHasChanged();
        }
    }
}
